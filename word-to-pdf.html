<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word → PDF Converter | Tools Bucket</title>
  <meta name="description" content="Client‑side Word (.docx) to PDF converter for Tools Bucket. No server needed." />
  <style>
    :root{
      --primary:#1677ff;
      --primary-600:#1966d2;
      --bg:#ffffff;
      --text:#0b1220;
      --muted:#6b7280;
      --border:#e5efff;
    }
    body{margin:0;font-family:Inter,Arial,sans-serif;background:#fff;color:var(--text)}
    .container{max-width:800px;margin:auto;padding:20px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .logo{width:40px;height:40px;border-radius:10px;background:var(--primary);display:grid;place-items:center;color:#fff;font-weight:800}
    h1{margin:0;font-size:28px}
    .subtitle{color:var(--muted);margin-top:4px}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:0 4px 12px rgba(22,119,255,.15)}
    .dropzone{border:2px dashed var(--border);border-radius:12px;padding:30px;text-align:center;position:relative}
    .dropzone input{position:absolute;inset:0;opacity:0;cursor:pointer}
    .btn{background:var(--primary);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.secondary{background:#fff;color:var(--primary);border:1px solid var(--border)}
    .status{margin-top:10px;color:var(--muted)}
    #converted-html{position:fixed;inset:-9999px;visibility:hidden}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">TB</div>
      <div>
        <h1>Word → PDF Converter</h1>
        <div class="subtitle">Convert .docx files to downloadable PDFs — 100% client‑side.</div>
      </div>
    </div>

    <main class="card">
      <label class="dropzone" id="dropzone">
        <input id="file" type="file" accept=".docx" />
        <p><strong>Drop your Word file here</strong><br><small>or click to browse (.docx only)</small></p>
      </label>
      <div style="margin-top:15px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="convertBtn" disabled>Convert to PDF</button>
        <button class="btn secondary" id="resetBtn" disabled>Reset</button>
      </div>
      <div class="status" id="status">Awaiting file…</div>
    </main>

    <div id="converted-html"></div>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx-preview@0.4.0/dist/docx-preview.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docx-preview@0.4.0/dist/docx-preview.css">
  <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <script>
    const fileInput=document.getElementById('file');
    const dropzone=document.getElementById('dropzone');
    const convertBtn=document.getElementById('convertBtn');
    const resetBtn=document.getElementById('resetBtn');
    const statusEl=document.getElementById('status');
    const convertedHtml=document.getElementById('converted-html');

    let currentFile=null;

    function setStatus(msg,color){statusEl.textContent=msg;if(color)statusEl.style.color=color;else statusEl.style.color='var(--muted)'}
    function enableButtons(has){convertBtn.disabled=!has;resetBtn.disabled=!has}

    fileInput.addEventListener('change',e=>{const f=e.target.files[0];if(f){currentFile=f;setStatus('Ready to convert: '+f.name,'var(--primary)');enableButtons(true)}});

    dropzone.addEventListener('drop',e=>{e.preventDefault();const f=e.dataTransfer.files[0];if(f){fileInput.files=e.dataTransfer.files;currentFile=f;setStatus('Ready to convert: '+f.name,'var(--primary)');enableButtons(true)}});
    dropzone.addEventListener('dragover',e=>e.preventDefault());

    resetBtn.addEventListener('click',()=>{fileInput.value='';currentFile=null;enableButtons(false);setStatus('Awaiting file…')});

    convertBtn.addEventListener('click',async()=>{
      if(!currentFile) return;
      try{
        setStatus('Converting…','var(--primary)');
        const arrayBuffer=await currentFile.arrayBuffer();
        let html="";
        try{
          const result=await window.mammoth.convertToHtml({arrayBuffer});
          html=result.value;
        }catch(e){console.warn('Mammoth failed, using docx-preview',e)}
        if(html && html.trim()){
          convertedHtml.innerHTML='<div>'+html+'</div>';
        }else{
          convertedHtml.innerHTML='';
          await window.DOCX.renderAsync(arrayBuffer,convertedHtml,null,{inWrapper:true});
        }
        const filename=(currentFile.name.replace(/\.[^.]+$/, '')||'document')+'.pdf';
        await html2pdf().from(convertedHtml).set({filename,margin:10,html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4'}}).save();
        setStatus('Done! PDF downloaded.','green');
      }catch(err){console.error(err);setStatus('Conversion failed: '+err.message,'red')}
    });
  </script>
</body>
</html>
